<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TestMaker Live Dashboard</title>
    <link rel="stylesheet" href="/assets/dashboard.css">
</head>

<body>

    <header>
        <div style="display:flex; flex-direction: column; gap: 10px;">
            <div style="display:flex; align-items:center; gap:10px; justify-content: space-between;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <h1>TestMaker Live <span style="font-size:14px; color:#4da6ff; vertical-align:middle;">‚óè</span></h1>
                    <div id="supervisor-badge" class="status-badge"
                        style="display:none; font-size: 11px; padding: 2px 8px; border-radius: 12px; background: #334155; color: #94a3b8; border: 1px solid #475569;">
                        üõ°Ô∏è Watchtower: <span id="supervisor-status">Unknown</span>
                    </div>
                </div>

                <!-- Environment Selector -->
                <div class="filter-group" style="margin:0;">
                    <button class="filter-btn active" id="env-stage" onclick="switchEnvironment('stage')"
                        style="font-size: 13px;">
                        üü¶ Stage
                    </button>
                    <button class="filter-btn" id="env-dev" onclick="switchEnvironment('dev')" style="font-size: 13px;">
                        üü© Dev
                    </button>
                </div>
            </div>

            <!-- Runner Box -->
            <div class="runner-box">
                <input type="text" id="target-url" class="runner-input" placeholder="Enter target URL to search..."
                    value="https://stage.ianai.co/">
                <button id="btn-start" class="runner-btn btn-start" onclick="startSearch()">Start Search</button>
                <button id="btn-stop" class="runner-btn btn-stop" onclick="stopSearch()">Stop</button>
                <button id="btn-research-fail" class="runner-btn" onclick="researchFailures()"
                    style="display:none; background: #d35400; font-size: 13px;">Re-search FAIL (<span
                        id="fail-count-btn">0</span>)</button>
                <span id="runner-status" class="runner-status">Idle</span>
                <span id="queue-status" class="runner-status" style="display:none; background: #2980b9;">Queue: 0</span>
            </div>
        </div>

        <div style="display:flex; align-items:center; gap:20px;">
            <a href="#" id="trace-link" class="trace-btn" target="_blank">Download Trace</a>
            <div class="stats">
                <div class="card">
                    <span class="value" id="count">0</span>
                    <span class="label">Searched Pages</span>
                </div>
                <div class="card">
                    <span class="value" id="shot-count">0</span>
                    <span class="label">Screenshots</span>
                </div>
            </div>
        </div>
    </header>

    <div class="filter-bar">
        <div class="filter-group" id="type-filters">
            <button class="filter-btn active" onclick="setFilter('ALL')">ALL <span id="count-all"
                    class="filter-count">0</span></button>
            <button class="filter-btn" onclick="setFilter('PAGE')">PAGE <span id="count-page"
                    class="filter-count">0</span></button>
            <button class="filter-btn" onclick="setFilter('MODAL')">MODAL <span id="count-modal"
                    class="filter-count">0</span></button>
            <button class="filter-btn" onclick="setFilter('DETAIL')">DETAIL <span id="count-detail"
                    class="filter-count">0</span></button>
            <button class="filter-btn" onclick="setFilter('DUP')">DUP <span id="count-duplicate"
                    class="filter-count">0</span></button>
        </div>

        <div class="filter-group" id="status-filters">
            <button class="filter-btn status-pass" onclick="setStatusFilter('PASS')">PASS <span id="count-pass"
                    class="filter-count">0</span></button>
            <button class="filter-btn status-fail" onclick="setStatusFilter('FAIL')">FAIL <span id="count-fail"
                    class="filter-count">0</span></button>
            <button class="filter-btn status-block" onclick="setStatusFilter('BLOCK')">BLOCK <span id="count-block"
                    class="filter-count">0</span></button>
            <button class="filter-btn status-untagged" onclick="setStatusFilter('UNTAGGED')">? <span id="count-untagged"
                    class="filter-count">0</span></button>
        </div>
    </div>

    <div class="gallery" id="gallery"></div>
    <div class="loading" id="loading">Loading more...</div>
    <div id="sentinel" style="height: 20px; margin-top: 20px;"></div>

    <!-- Lightbox Modal -->
    <div class="modal" id="modal">
        <div class="modal-title" id="modal-title"></div>
        <div class="close-container">
            <button class="back-btn" onclick="closeModal()">Back to Gallery</button>
            <button class="close-icon" onclick="closeModal()">&times;</button>
        </div>

        <button class="modal-nav prev-btn" onclick="prevImage()">&#10094;</button>
        <button class="modal-nav next-btn" onclick="nextImage()">&#10095;</button>

        <img src="" alt="" class="modal-img" id="modal-img">

        <div class="qa-toolbar">
            <button class="qa-btn btn-pass" onclick="setTag('PASS')">PASS</button>
            <button class="qa-btn btn-fail" onclick="setTag('FAIL')">FAIL</button>
            <button class="qa-btn btn-block" onclick="setTag('BLOCK')">BLOCK</button>
        </div>

        <div id="fail-reason-container" style="display:none; width: 80%; margin-top: 10px;">
            <textarea id="fail-reason" placeholder="Why did this fail? (e.g. Missing element, layout issue...)"
                style="width: 100%; height: 60px; background: #1e293b; color: white; border: 1px solid #475569; padding: 8px; border-radius: 4px; font-family: sans-serif; resize: vertical; margin-bottom: 5px;"></textarea>
            <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px;">
                <span id="reason-status" style="color: #94a3b8; font-size: 11px;"></span>
                <button onclick="saveReason()"
                    style="background: #3b82f6; border: none; color: white; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">Save</button>
            </div>
        </div>

        <div class="modal-history-container" style="width: 80%; margin-top: 20px;">
            <div style="font-size: 13px; font-weight: 600; color: #94a3b8; margin-bottom: 8px;">CAPTURE HISTORY</div>
            <div id="modal-history" class="history-list"></div>
        </div>
        <div class="modal-hint">Use ‚Üê ‚Üí arrow keys to navigate</div>
    </div>

    <script type="module" src="/assets/js/main.js"></script>

</body>

</html>